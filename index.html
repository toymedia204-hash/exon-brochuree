import React, { useState, useEffect, useRef } from 'react';
import { 
  ChevronDown, 
  ChevronLeft, 
  ChevronRight, 
  Cpu, 
  Shield, 
  RefreshCcw, 
  TrendingUp, 
  Target, 
  Zap
} from 'lucide-react';

const App = () => {
  const [activeTab, setActiveTab] = useState('01');
  const [introStatus, setIntroStatus] = useState('starting'); // starting -> glowing -> dissolving -> finished
  const [scrollProgress, setScrollProgress] = useState(0);
  const scrollRef = useRef(null);
  const audioCtx = useRef(null);

  // 시네마틱 인트로 사운드 합성
  const playIntroSound = () => {
    try {
      if (!audioCtx.current) audioCtx.current = new (window.AudioContext || window.webkitAudioContext)();
      const ctx = audioCtx.current;
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      const filter = ctx.createBiquadFilter();

      osc.type = 'sawtooth';
      filter.type = 'lowpass';
      filter.frequency.setValueAtTime(100, ctx.currentTime);
      filter.frequency.exponentialRampToValueAtTime(3000, ctx.currentTime + 1.5);
      
      gain.gain.setValueAtTime(0, ctx.currentTime);
      gain.gain.linearRampToValueAtTime(0.2, ctx.currentTime + 0.5);
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 4);

      osc.connect(filter);
      filter.connect(gain);
      gain.connect(ctx.destination);

      osc.start();
      osc.stop(ctx.currentTime + 4);
    } catch (e) { console.log("Audio deferred"); }
  };

  const WHITE_PAPER = {
    '01': {
      label: "MANIFESTO",
      title: "01. BRAND MANIFESTO",
      subtitle: "지능의 새로운 변곡점",
      icon: <Cpu className="text-cyan-400" size={18} />,
      content: [
        "\"자동화는 끝이 아닙니다. 진화의 시작일 뿐입니다.\"",
        "솔직히 말씀드리겠습니다. 시장에는 이미 수만 개의 자동화 툴이 넘쳐납니다. 하지만 대부분은 인간이 정해준 입력값대로만 움직이는 '죽은 기계'에 불과합니다. 환경이 조금만 변해도 멈추고, 시간이 지날수록 유지보수 비용만 늘어가는 것이 현재의 한계입니다.",
        "EXON은 '도구'가 아닌 '유기체'를 설계합니다. 우리는 n8n의 견고한 워크플로우 위에 ChatGPT의 유연한 추론 능력을 이식했습니다. 단순 반복을 넘어, 스스로 상황을 인지하고 최적의 경로를 찾아 진화하는 비즈니스 신경망. 이것이 EXON이 정의하는 차세대 자동화의 기준입니다."
      ]
    },
    '02': {
      label: "CORE",
      title: "02. CORE SYSTEM",
      subtitle: "완벽한 통제와 규격화",
      icon: <Shield className="text-blue-500" size={18} />,
      content: [
        "EXON의 시스템은 '자유로운 창의성'을 지향하되, 그 과정은 '강력한 규격'으로 통제됩니다. 비즈니스 환경에서 '예측 불가능한 품질'은 곧 리스크이기 때문입니다.",
        "Standardized Controller (표준화 컨트롤러): 주제(Topic), 스타일(Style), 아바타(Avatar), 보이스(Voice)라는 4대 핵심 축을 데이터로 정의합니다. AI의 불확실성을 인간의 의도 안에 가두어, 어떤 상황에서도 브랜드 정체성을 100% 유지하는 고품질 결과물을 보장합니다.",
        "Creative ID Logging (전수 로깅 시스템): 모든 생성 프로세스에는 고유의 creative_id가 부여됩니다. 기획부터 최종 출력까지의 전 과정을 초 단위로 추적(Traceability)하여, 문제 발생 시 즉각적인 원인 분석이 가능할 뿐만 아니라 모든 데이터를 기업의 소중한 지적 자산으로 변환합니다."
      ]
    },
    '03': {
      label: "STABILITY",
      title: "03. STABILITY",
      subtitle: "엔터프라이즈급 운영 무결성",
      icon: <Zap className="text-yellow-500" size={18} />,
      content: [
        "실제 비즈니스 현장은 이론만큼 매끄럽지 않습니다. EXON은 다양한 변수까지 계산한 강력한 기술적 방어막을 갖추고 있습니다.",
        "Advanced Stability (운영 안정화): 외부 API의 지연이나 타임아웃에 대비한 스마트 재시도(Retry) 로직을 탑재하여 시스템의 연속성을 보장합니다.",
        "Fallback Protocol (안전 모드): 시스템이 스스로 판단할 수 없는 임계점을 넘어서면, 억지로 진행하지 않고 즉시 manual_needed 모드로 전환됩니다. 이는 서비스 사고를 미연에 방지하고 인간 전문가와의 유기적인 협업을 이끌어내는 EXON만의 '프로덕트 정신'입니다."
      ]
    },
    '04': {
      label: "RECYCLE",
      title: "04. THE RECYCLE LOOP",
      subtitle: "분석 자동화와 자율 진화",
      icon: <RefreshCcw className="text-cyan-500" size={18} />,
      content: [
        "이것이 EXON을 독보적으로 만드는 심장부입니다. 우리는 결과물을 내놓고 끝내는 소모적 방식에서 벗어나 '지능의 재활용(Recycle)' 시스템을 완성했습니다.",
        "데이터 수집 및 성과 추적: 생성된 콘텐츠의 시장 반응도와 성과 데이터를 실시간 트래킹하고, ChatGPT가 이를 바탕으로 현재 로직과 프롬프트의 강약점을 심층 분석합니다.",
        "재귀적 최적화 (Recursive Optimization): 분석된 통찰은 즉시 시스템의 입력값으로 환원되어 다음 생성 단계에 반영됩니다. 인간의 개입 없이도 시스템이 스스로 전문가로 진화하는 임계점을 제공합니다."
      ]
    },
    '05': {
      label: "ECONOMICS",
      title: "05. ECONOMICS",
      subtitle: "압도적 ROI와 무한한 레버리지",
      icon: <TrendingUp className="text-emerald-500" size={18} />,
      content: [
        "EXON 도입이 가져오는 경제적 가치는 단순한 인건비 절감을 넘어 사업의 '영토 확장성'에 있습니다.",
        "압도적 비용 효율: 콘텐츠 제작 단가를 99% 이상 절감하여 자본의 효율성을 극대화합니다.",
        "무한 레버리지 제공: 인건비와 운영비의 물리적 한계에 갇히지 않고, 혼자서 수십 개의 '자율 주행 회사'를 늘려나갈 수 있는 구조적 힘을 제공합니다. 이는 1인 기업이 중견기업 이상의 퍼포먼스를 내는 핵심 동력이 됩니다.",
        "산출 불가능한 마케팅 가치: 스스로 진화하며 최적의 광고 효율과 콘텐츠 반응도를 찾아내는 과정에서 절감되는 마케팅 비용은 단순한 숫자로 환산할 수 없습니다. 이는 '실패 비용의 제로화'와 '성공의 진폭 확대'를 의미하며, 기업의 가장 강력한 무형 자산이 됩니다."
      ]
    },
    '06': {
      label: "FUTURE",
      title: "06. FUTURE ROADMAP",
      subtitle: "드롭쉬핑 AI 아바타 혁명",
      icon: <Target className="text-purple-500" size={18} />,
      content: [
        "EXON의 기술력은 이제 '촬영 프로세스의 종말'을 선언하며 구체적인 비즈니스 모델로 확장됩니다.",
        "Hyper-Realistic AI Models: 브랜드에 최적화된 가상 모델이 24시간 콘텐츠를 생산하며, 브랜드에 최적화된 가상 모델이 24시간 멈추지 않고 고해상도 패션 화보와 상세페이지를 생산합니다.",
        "End-to-End Automation: 우리는 단순히 이미지를 만드는 것을 넘어, 상품 소싱 분석부터 마케팅 소재 생성, 고객 CS 응대까지 드롭쉬핑의 전 과정을 자율적으로 수행하는 '무인 비즈니스 지능체'로 확장되어 나갈 것입니다."
      ]
    }
  };

  const tabs = Object.keys(WHITE_PAPER);
  const goToNext = () => setActiveTab(prev => tabs[Math.min(tabs.indexOf(prev) + 1, tabs.length - 1)]);
  const goToPrev = () => setActiveTab(prev => tabs[Math.max(tabs.indexOf(prev) - 1, 0)]);

  useEffect(() => {
    // 시네마틱 인트로 시퀀스 타이밍
    const timer1 = setTimeout(() => setIntroStatus('glowing'), 800);
    const timer2 = setTimeout(() => {
      setIntroStatus('dissolving');
      playIntroSound();
    }, 2200);
    const timer3 = setTimeout(() => setIntroStatus('finished'), 4200);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
      clearTimeout(timer3);
    };
  }, []);

  useEffect(() => {
    if (scrollRef.current) {
      scrollRef.current.scrollTop = 0;
      setScrollProgress(0);
    }
  }, [activeTab]);

  return (
    <div className="min-h-screen bg-[#010204] text-white flex flex-col items-center justify-center font-sans overflow-hidden p-4 relative">
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@200;300;600;800&display=swap');
        .exo-font { font-family: 'Exo 2', sans-serif; }
        
        /* 인트로 로고 애니메이션 */
        .intro-logo {
          font-family: 'Exo 2', sans-serif;
          font-weight: 200;
          letter-spacing: 1.5em;
          transition: all 2.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .logo-initial { opacity: 0.6; color: #ffffff; text-shadow: none; filter: blur(0); transform: scale(0.9); }
        /* 로고 광채 강화: 화살표 광채와 비슷한 수준으로 상향 */
        .logo-glowing { 
          opacity: 1; 
          color: #00ffff; 
          text-shadow: 0 0 20px rgba(0, 255, 255, 0.9), 0 0 40px rgba(0, 255, 255, 0.6); 
          filter: blur(0); 
          transform: scale(1); 
        }
        .logo-dissolving { 
          opacity: 0; 
          color: #00ffff; 
          text-shadow: 0 0 120px #00ffff; 
          filter: blur(50px); 
          transform: scale(1.6); 
        }

        /* 본문 로고 스타일 (광채 적용) */
        .logo-style { 
          font-family: 'Exo 2', sans-serif; 
          font-weight: 200; 
          letter-spacing: 0.7em; 
          color: #00ffff;
          text-shadow: 0 0 15px rgba(0, 255, 255, 0.8), 0 0 30px rgba(0, 255, 255, 0.4);
        }

        .content-entry {
          animation: focus-in 2s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        @keyframes focus-in {
          0% { filter: blur(30px); opacity: 0; transform: scale(0.98); }
          100% { filter: blur(0); opacity: 1; transform: scale(1); }
        }

        .content-scroll::-webkit-scrollbar { width: 0px; }
        
        /* 배경 무한 루프 광선 */
        .loop-background {
          position: absolute;
          inset: 0;
          overflow: hidden;
          background: #0a1622;
        }
        .light-beam {
          position: absolute;
          width: 300%;
          height: 300%;
          top: -100%;
          left: -100%;
          background: repeating-linear-gradient(
            45deg,
            transparent,
            transparent 120px,
            rgba(0, 255, 255, 0.4) 120px,
            rgba(0, 255, 255, 0.4) 123px
          );
          animation: rotate-beams 30s linear infinite;
          opacity: 0.8;
          mix-blend-mode: screen;
        }
        @keyframes rotate-beams {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .slide-enter { animation: slide-in 1s cubic-bezier(0.23, 1, 0.32, 1) forwards; }
        @keyframes slide-in {
          0% { transform: scale(0.98) translateX(20px); opacity: 0; }
          100% { transform: scale(1) translateX(0); opacity: 1; }
        }
      `}</style>

      {introStatus !== 'finished' ? (
        <div className="fixed inset-0 bg-[#010204] flex flex-col items-center justify-center z-[999] font-sans">
          <h1 className={`intro-logo text-4xl md:text-7xl pl-[1.5em] 
            ${introStatus === 'starting' ? 'logo-initial' : ''} 
            ${introStatus === 'glowing' ? 'logo-glowing' : ''} 
            ${introStatus === 'dissolving' ? 'logo-dissolving' : ''}`}>
            EXON
          </h1>
          <div className="absolute bottom-12 flex flex-col items-center gap-3 opacity-20">
            <Zap size={14} className="text-cyan-400 animate-pulse" />
            <p className="text-[6px] text-zinc-300 tracking-[0.6em] font-black uppercase">Establishing Neural Uplink</p>
          </div>
        </div>
      ) : (
        <div className="w-full h-full max-w-md flex flex-col space-y-4 relative z-10 content-entry">
          
          <nav className="grid grid-cols-6 gap-1.5 bg-zinc-900/50 p-1.5 rounded-2xl border border-zinc-700/50 backdrop-blur-xl shrink-0 shadow-2xl">
            {tabs.map(num => (
              <button
                key={num}
                onClick={() => setActiveTab(num)}
                className={`py-2 text-[7px] font-black rounded-xl transition-all duration-500 border ${activeTab === num ? 'bg-cyan-950/60 text-cyan-400 border-cyan-500/50 shadow-[0_0_20px_rgba(0,255,255,0.4)]' : 'text-zinc-400 border-transparent hover:text-zinc-200 hover:bg-white/5'}`}
              >
                {WHITE_PAPER[num].label.substring(0, 3)}
              </button>
            ))}
          </nav>

          <div className="relative flex-1 aspect-[9/16] bg-black rounded-[3.8rem] overflow-hidden shadow-[0_0_150px_rgba(0,0,0,1)] border-[14px] border-zinc-800 ring-1 ring-zinc-700 flex flex-col">
            
            {/* 좌우 네비게이션 버튼 (광채 기준점) */}
            <button 
              onClick={goToPrev}
              disabled={tabs.indexOf(activeTab) === 0}
              className={`absolute left-3 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-black/80 backdrop-blur-xl border-2 border-cyan-400 text-cyan-400 z-[90] shadow-[0_0_25px_rgba(0,255,255,0.9)] active:scale-90 transition-all flex items-center justify-center ${tabs.indexOf(activeTab) === 0 ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}
            >
              <ChevronLeft size={32} strokeWidth={3} />
            </button>
            <button 
              onClick={goToNext}
              disabled={tabs.indexOf(activeTab) === tabs.length - 1}
              className={`absolute right-3 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-black/80 backdrop-blur-xl border-2 border-cyan-400 text-cyan-400 z-[90] shadow-[0_0_25px_rgba(0,255,255,0.9)] active:scale-90 transition-all flex items-center justify-center ${tabs.indexOf(activeTab) === tabs.length - 1 ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}
            >
              <ChevronRight size={32} strokeWidth={3} />
            </button>

            <div className="loop-background"><div className="light-beam"></div></div>
            <div className="absolute inset-0 bg-gradient-to-b from-black/95 via-black/40 to-black/98 z-0"></div>

            <div key={activeTab} className="relative z-10 h-full flex flex-col exo-font slide-enter p-10 overflow-y-auto content-scroll scroll-smooth" ref={scrollRef} onScroll={(e) => setScrollProgress((e.target.scrollTop / (e.target.scrollHeight - e.target.clientHeight)) * 100)}>
              <header className="pt-10 flex flex-col items-center shrink-0">
                <h1 className="logo-style text-2xl text-cyan-400 pl-4 tracking-[1.2em]">EXON</h1>
                <p className="text-[6px] tracking-[1.4em] text-zinc-300 font-bold uppercase mt-4 opacity-40">Intelligence Evolution</p>
              </header>

              <div className="mt-10 space-y-10">
                <div className="space-y-4">
                  <div className="flex items-center gap-3">
                    <div className="p-3 bg-cyan-500/10 rounded-2xl border border-cyan-400/30 shadow-[0_0_15px_rgba(0,255,255,0.2)]">
                      {WHITE_PAPER[activeTab].icon}
                    </div>
                    <span className="text-[10px] text-cyan-300 font-mono font-bold tracking-widest uppercase italic">Node 0{activeTab}</span>
                  </div>
                  <h2 className="text-3xl font-extrabold tracking-tighter leading-tight text-white drop-shadow-2xl italic">{WHITE_PAPER[activeTab].title}</h2>
                  <p className="text-cyan-400 text-xs font-semibold tracking-[0.2em]">{WHITE_PAPER[activeTab].subtitle}</p>
                </div>

                <div className="space-y-10 pb-56">
                  {WHITE_PAPER[activeTab].content.map((para, i) => (
                    <p key={i} className={`text-[15px] leading-[2.3] text-zinc-100 font-light ${i === 0 ? 'italic text-cyan-50 bg-cyan-900/30 p-8 rounded-[3rem] border-l-4 border-cyan-400 shadow-2xl' : ''}`}>
                      {para}
                    </p>
                  ))}
                </div>
              </div>

              {/* 지능형 플로팅 스크롤 안내 (영문 대문자 SCROLL 적용) */}
              <div 
                className={`fixed bottom-6 left-1/2 -translate-x-1/2 flex flex-col items-center transition-all duration-700 pointer-events-none z-[100]
                ${scrollProgress > 95 ? 'opacity-0 translate-y-10 scale-50' : 'opacity-100'}`}
              >
                <div className="flex flex-col items-center animate-bounce">
                  <p className="text-[9px] text-cyan-400 font-black tracking-[0.4em] mb-1 opacity-80 exo-font uppercase">SCROLL</p>
                  <ChevronDown size={54} className="text-cyan-400 drop-shadow-[0_0_15px_rgba(0,255,255,1)]" strokeWidth={1} />
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default App;
